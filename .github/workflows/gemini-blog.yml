# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å…¨ä½“ã«ãƒªãƒã‚¸ãƒˆãƒªã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸
permissions:
  contents: write

name: Daily Gemini Quote Blog

on:
  schedule:
    - cron: '0 17 * * *'  # æ—¥æœ¬æ™‚é–“02:00ï¼ˆUTCã§æŒ‡å®šï¼‰
  workflow_dispatch:     #æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½ã«ã™ã‚‹

jobs:
  generate-quote:
    runs-on: ubuntu-latest

    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4 # æœ€æ–°ã®v4ã«æ›´æ–°

      - name: ğŸ›  Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v4 # æœ€æ–°ã®v4ã«æ›´æ–°
        with:
          node-version: '18'

      - name: ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆaxiosï¼‰
        run: npm install axios # package.jsonãŒãªã„å ´åˆã¯ã“ã‚Œã§OK

      - name: âœ¨ Gemini APIã§æ ¼è¨€ï¼ˆæ—¥æœ¬èªï¼‹è‹±èªï¼‰ã‚’ç”Ÿæˆã—Markdownã«ä¿å­˜
        run: |
          node .github/scripts/generate-quote.js

      - name: âœ… Gitã¸ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git add _posts/*.md
          # å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œ
          if ! git diff --cached --quiet; then
            echo "å¤‰æ›´ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚"
            git commit -m "ğŸ§  Geminiæ ¼è¨€ã‚’è‡ªå‹•æŠ•ç¨¿ (`date --iso-8601=seconds`)"
            git push
          else
            echo "å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
          fi
