# .github/workflows/your-workflow-file.yml ã®ä¸­ã®é©åˆ‡ãªå ´æ‰€ã«è¿½åŠ 

permissions:
  contents: write # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¸ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸
name: Daily Gemini Quote Blog

on:
  schedule:
    - cron: '0 17 * * *'  # æ—¥æœ¬æ™‚é–“02:00ï¼ˆUTCã§æŒ‡å®šï¼‰
  workflow_dispatch:

jobs:
  generate-quote:
    runs-on: ubuntu-latest

    env:
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}

    steps:
      - name: ğŸ“¥ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: ğŸ›  Node.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: ğŸ“¦ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆaxiosï¼‰
        run: npm install axios

      - name: âœ¨ Gemini APIã§æ ¼è¨€ï¼ˆæ—¥æœ¬èªï¼‹è‹±èªï¼‰ã‚’ç”Ÿæˆã—Markdownã«ä¿å­˜
        run: |
          node .github/scripts/generate-quote.js

     - name: âœ… Gitã¸ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config user.name "github-actions[bot]" # Gitã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã‚ˆã‚Šä¸€èˆ¬çš„ãªãƒœãƒƒãƒˆç”¨ã«å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com" # åŒä¸Š
          git add _posts/*.md
          # å¤‰æ›´ãŒã‚ã£ãŸå ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œ
          if ! git diff --cached --quiet; then
            echo "å¤‰æ›´ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚"
            git commit -m "ğŸ§  Geminiæ ¼è¨€ã‚’è‡ªå‹•æŠ•ç¨¿ (`date --iso-8601=seconds`)" # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ—¥æ™‚ã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
            git push
          else
            echo "å¤‰æ›´ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã¯ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚"
          fi
